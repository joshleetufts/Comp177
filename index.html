<!DOCTYPE html>
<html>
	<head>
		<title> Crash viz on crashes </title>
    	<script type="text/javascript" src="d3/d3.min.js"></script>
    	<style>
	    	.axis .domain {
		    	display: none;
	    	}
	   	</style>
	   	<link href="style.css" rel="stylesheet" type="text/css">
  	</head>
  	<body>
    	<div class = "intro">
		      <h1>Could data visualizations make you a better driver?</h1>
		      <p>From 2006-2015 there were a reported 70,000 car accidents among 9 counties in upstate New York. And while drivers should stay vigilant regardless of where they are, we set to find out whether specific counties are prone to certain kinds of accidents.</p>

 		 </div>

    	<div id = "bubblegraph">
    	</div>

	   	<svg width="960" height="500"></svg>

    	<div id = "treemap">
    	</div>

    	<div id = "relationgraph">
    	</div>

    	<div id = "bargraph">
    	</div>
    	
    	<script>

    		var w = 1000;
    		var h = 500;
    		// var dataArray = [20, 40, 50, 60]; 


    		var canvas = d3.select("#bubblegraph")
    			.append("svg")
			      .attr("width", w)
			      .attr("height", h)
			      .append("g")		    

			var radiusScale = d3.scaleSqrt().domain([1, 988]).range([10, 50])

			var simulation = d3.forceSimulation()
				.force("x", d3.forceX(w/2).strength(0.02))
				.force("y",d3.forceY(h/2).strength(0.01))
				.force("collide", d3.forceCollide(5))
			
			function filterCriteria(d){
				return d.county === "MONROE";
			}

			// d3.queue()
			// 	.defer(d3.csv, "data/data.csv")
			// 	.await(createNodes)

			// d3.csv("data/data.csv", function(data){
			// 	createNodes(err, data);
			// })

			function createNodes(datapoints){
				
				var circles = canvas.selectAll()
					.data(datapoints)
					.enter()
						.append("circle")
						.attr("r", 5)
						.attr("fill", "lightblue")
						.on('click', function(d){
							console.log(d)
						})
						

				simulation.nodes(datapoints)
					.on('tick', ticked)

				function ticked() {
					circles
						.attr("cx", function(d){
							return d.x
						})
						.attr("cy", function(d){
							return d.y
						})
				}
			}


			







	  //   	var svg = d3.select("svg"),
		 //    margin = {top: 20, right: 20, bottom: 30, left: 40},
		 //    width = +svg.attr("width") - margin.left - margin.right,
		 //    height = +svg.attr("height") - margin.top - margin.bottom,
		 //    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
			// var x = d3.scaleBand()
			//     .rangeRound([0, width])
			//     .paddingInner(0.05)
			//     .align(0.1);
			
			// var y = d3.scaleLinear()
			//     .rangeRound([height, 0]);
			
			// var z = d3.scaleOrdinal()
			//     .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
			
			// var injuryData = '';    
	    	
	    	d3.csv("data/data.csv", function (csv_data) {
		    	csv_data.forEach(function(d) {
			    	d["Number of Injuries"] = +d["Number of Injuries"];
			    	d["Number of Serious Injuries"] = +d["Number of Serious Injuries"];
			    	d["Number of Fatalities"] = +d["Number of Fatalities"];
				});

				var county = d3.nest()
					.key(function(d) {return d["County"];})
					.rollup(function(d) {
						return d3.sum(d, function(g) { return 1})
					}).entries(csv_data)

				createNodes(county);
		    	
			    var injuries = d3.nest()
			    	.key(function(d) { return d["Case Year"]; })
			    	.rollup(function(d) {
				    	return d3.sum(d, function(g) { return g["Number of Injuries"]; });
			    	}).entries(csv_data)
			    	
			    var serious = d3.nest()
			    	.key(function(d) { return d["Case Year"]; })
			    	.rollup(function(d) {
				    	return d3.sum(d, function(g) { return g["Number of Serious Injuries"]; });
			    	}).entries(csv_data)
	
			    var fatalities = d3.nest()
			    	.key(function(d) { return d["Case Year"]; })
			    	.rollup(function(d) {
				    	return d3.sum(d, function(g) { return g["Number of Fatalities"]; });
			    	}).entries(csv_data) 

		    console.log(JSON.stringify(injuries));
		    console.log(JSON.stringify(serious));
		    console.log(JSON.stringify(fatalities));
		    console.log(county);
		});
		    	
		 //    });
	    	
	    </script>
	    	
   	</body>
</html>